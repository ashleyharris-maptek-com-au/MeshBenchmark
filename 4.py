import math

prompt = """
Here is the points and faces of a regular tetrahedron with all sides equal 1, resting on the Z=0 plane and with an edge along the X=0 plane:

polyhedron(
    points = [
        [0, 0, 0],                               // 0
        [1, 0, 0],                               // 1
        [0.5, sqrt(3)/2, 0],                     // 2
        [0.5, sqrt(3)/6, sqrt(2/3)]              // 3 (apex)
    ],
    faces = [
        [0, 2, 1],   // base (oriented outward)
        [0, 1, 3],
        [1, 2, 3],
        [2, 0, 3]
    ],
    convexity = 4
);

We define a 7-part rigid transform of (x,y,z,q0,q1,q2,q3), where q0,q1,q2,q3 is a normalised quaternion, and x, y, z are the translation.
Rotation is defined around the 0,0,0 point, and is performed before translation.

We create a scene with mulitple tetrahedra, each with a different transform. Return the transforms of such a scene
such that a shadow projected vertically (onto the Z=0 plane) fully covers a square of side length 4, centered at the origin.

Score will be deducted for any shadow outside of the square, for reduntant tetrahedra, or non-normalised quaternions.
"""

structure = {
    "type": "array",
    "items": {
        "type": "object",
        "properties": {
            "x": { "type": "number" },
            "y": { "type": "number" },
            "z": { "type": "number" },
            "q0": { "type": "number" },
            "q1": { "type": "number" },
            "q2": { "type": "number" },
            "q3": { "type": "number" }
        }
    }
}

referenceScad = """
module reference(){
    translate([0,0,0.5]) cube([4,4,1], center=true);
}
"""

def quaternionToPitchRollYawInDegrees(q0, q1, q2, q3):
    return [math.degrees(math.atan2(2 * (q0 * q1 + q2 * q3), 1 - 2 * (q1 * q1 + q2 * q2))), 
            math.degrees(math.asin(2 * (q0 * q2 - q1 * q3))), 
            math.degrees(math.atan2(2 * (q0 * q3 + q1 * q2), 1 - 2 * (q2 * q2 + q3 * q3)))]

scadModules = """
module tetrahedron(){
    polyhedron(
        points = [
            [0, 0, 0],                               // 0
            [1, 0, 0],                               // 1
            [0.5, sqrt(3)/2, 0],                     // 2
            [0.5, sqrt(3)/6, sqrt(2/3)]              // 3 (apex)
        ],
        faces = [
            [0, 2, 1],   // base (oriented outward)
            [0, 1, 3],
            [1, 2, 3],
            [2, 0, 3]
        ],
        convexity = 4
    );
  
}
"""

def resultToScad(result):
    scad = "module result(){ " 
    scad += "linear_extrude(height=1){ projection() { union() {"
    for transform in result:
        scad += "translate([" + str(transform["x"]) + "," + \
            str(transform["y"]) + "," + str(transform["z"]) + "]) rotate(" + \
            str(quaternionToPitchRollYawInDegrees(transform["q0"], transform["q1"], transform["q2"], transform["q3"])) + ") tetrahedron();\n"
    return scad + "}}}}\n\n"

gemini3Answer = [
[
  {"x" : -1.500000, "y" : 2.598076, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : -0.500000, "y" : 2.598076, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : 0.500000, "y" : 2.598076, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : 1.500000, "y" : 2.598076, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : 2.500000, "y" : 2.598076, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},

  {"x" : -2.000000, "y" : 1.732051, "z" : 0.000000, "q0" : 1.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 0.000000},
  {"x" : -1.000000, "y" : 1.732051, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : -1.000000, "y" : 1.732051, "z" : 0.000000, "q0" : 1.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 0.000000},
  {"x" : 0.000000, "y" : 1.732051, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : 0.000000, "y" : 1.732051, "z" : 0.000000, "q0" : 1.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 0.000000},
  {"x" : 1.000000, "y" : 1.732051, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : 1.000000, "y" : 1.732051, "z" : 0.000000, "q0" : 1.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 0.000000},
  {"x" : 2.000000, "y" : 1.732051, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : 2.000000, "y" : 1.732051, "z" : 0.000000, "q0" : 1.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 0.000000},

  {"x" : -2.500000, "y" : 0.866025, "z" : 0.000000, "q0" : 1.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 0.000000},
  {"x" : -1.500000, "y" : 0.866025, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : -1.500000, "y" : 0.866025, "z" : 0.000000, "q0" : 1.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 0.000000},
  {"x" : -0.500000, "y" : 0.866025, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : -0.500000, "y" : 0.866025, "z" : 0.000000, "q0" : 1.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 0.000000},
  {"x" : 0.500000, "y" : 0.866025, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : 0.500000, "y" : 0.866025, "z" : 0.000000, "q0" : 1.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 0.000000},
  {"x" : 1.500000, "y" : 0.866025, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : 1.500000, "y" : 0.866025, "z" : 0.000000, "q0" : 1.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 0.000000},
  {"x" : 2.500000, "y" : 0.866025, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},

  {"x" : -2.000000, "y" : 0.000000, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : -2.000000, "y" : 0.000000, "z" : 0.000000, "q0" : 1.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 0.000000},
  {"x" : -1.000000, "y" : 0.000000, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : -1.000000, "y" : 0.000000, "z" : 0.000000, "q0" : 1.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 0.000000},
  {"x" : 0.000000, "y" : 0.000000, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : 0.000000, "y" : 0.000000, "z" : 0.000000, "q0" : 1.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 0.000000},
  {"x" : 1.000000, "y" : 0.000000, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : 1.000000, "y" : 0.000000, "z" : 0.000000, "q0" : 1.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 0.000000},
  {"x" : 2.000000, "y" : 0.000000, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : 2.000000, "y" : 0.000000, "z" : 0.000000, "q0" : 1.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 0.000000},

  {"x" : -2.500000, "y" : -0.866025, "z" : 0.000000, "q0" : 1.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 0.000000},
  {"x" : -1.500000, "y" : -0.866025, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : -1.500000, "y" : -0.866025, "z" : 0.000000, "q0" : 1.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 0.000000},
  {"x" : -0.500000, "y" : -0.866025, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : -0.500000, "y" : -0.866025, "z" : 0.000000, "q0" : 1.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 0.000000},
  {"x" : 0.500000, "y" : -0.866025, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : 0.500000, "y" : -0.866025, "z" : 0.000000, "q0" : 1.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 0.000000},
  {"x" : 1.500000, "y" : -0.866025, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : 1.500000, "y" : -0.866025, "z" : 0.000000, "q0" : 1.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 0.000000},
  {"x" : 2.500000, "y" : -0.866025, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : 2.500000, "y" : -0.866025, "z" : 0.000000, "q0" : 1.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 0.000000},

  {"x" : -2.000000, "y" : -1.732051, "z" : 0.000000, "q0" : 1.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 0.000000},
  {"x" : -1.000000, "y" : -1.732051, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : -1.000000, "y" : -1.732051, "z" : 0.000000, "q0" : 1.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 0.000000},
  {"x" : 0.000000, "y" : -1.732051, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : 0.000000, "y" : -1.732051, "z" : 0.000000, "q0" : 1.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 0.000000},
  {"x" : 1.000000, "y" : -1.732051, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : 1.000000, "y" : -1.732051, "z" : 0.000000, "q0" : 1.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 0.000000},
  {"x" : 2.000000, "y" : -1.732051, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : 2.000000, "y" : -1.732051, "z" : 0.000000, "q0" : 1.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 0.000000},

  {"x" : -1.500000, "y" : -2.598076, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : -1.500000, "y" : -2.598076, "z" : 0.000000, "q0" : 1.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 0.000000},
  {"x" : -0.500000, "y" : -2.598076, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : 0.500000, "y" : -2.598076, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : 1.500000, "y" : -2.598076, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000},
  {"x" : 2.500000, "y" : -2.598076, "z" : 0.000000, "q0" : 0.000000, "q1" : 0.000000, "q2" : 0.000000, "q3" : 1.000000}
]
]