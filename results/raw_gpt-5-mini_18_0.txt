// Pharaoh's Pyramid plan (OpenSCAD)
// Units: meters
// Cube side length: s = 0.500 m (50 cm)
// Base layer cube count per side: N = 38
// Total stones used = sum_{k=1..N} k^2 = 19019 (of 20000 available)
// Pyramid height = N * s = 38 * 0.5 = 19.0 m
// Pyramid faces north (+Y). Pyramid is centered at origin (0,0) over the tomb.
// Each cube is placed so each stone above sits with its 4 base corners on the centers of 4 stones below.

// Parameters
s = 0.500;        // side length of one stone (m)
N = 38;           // number of stones along one side of the base layer

// Precompute base offset so the entire pyramid is centered at (0,0).
// a0 is the X/Y coordinate of the first cube center on the bottom layer.
a0 = -((N - 1) / 2) * s;

// Module to generate the stepped pyramid using cubes placed on integer layers.
// Each layer k (0 = bottom) has M = N - k cubes per side.
// The layer offset is a0 + k*(s/2) because each successive layer's centers are shifted by s/2.
module pyramid()
{
    for (k = [0 : N - 1]) {
        M = N - k;
        layer_offset = a0 + k * (s / 2); // center coordinate (first cube center) for this layer

        // place M x M cubes for layer k; cubes sit on top of layer k-1 (or on ground for k=0)
        for (ix = [0 : M - 1]) {
            cx = layer_offset + ix * s; // center x of this cube
            for (iy = [0 : M - 1]) {
                cy = layer_offset + iy * s; // center y of this cube
                // Place cube with its base at z = k*s and size s, s, s.
                // Use translate to position corner at (center - s/2).
                translate([round((cx - s/2) * 1000) / 1000, round((cy - s/2) * 1000) / 1000, round((k * s) * 1000) / 1000])
                    cube([s, s, s], center = false);
            }
        }
    }
}

// For the masons, produce the outer shell view in solid mode.
// The geometry is precise to the millimeter (coordinates are rounded to 0.001 m).
pyramid();