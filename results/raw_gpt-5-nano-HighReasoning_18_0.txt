// OpenSCAD plan: Tallest pyramid with budget of 20,000 stones (50 cm edge cubes)
// Each layer rests on the four stones beneath (2x2 bridging), forming a solid stepped pyramid.
// Bottom layer: 38 x 38 stones; layers decrease by 1 in each dimension up to 1x1 apex.
// Stone size: 500 mm (0.5 m) per edge.
// Height: 38 layers * 0.5 m = 19 m; Base footprint: 19 m x 19 m.
// North is +y. The tomb center is at the origin; pyramid is centered on tomb.
// Budget check: uses S(38) = sum_{k=1}^{38} k^2 = 19,019 stones. Remaining budget: 20,000 - 19,019 = 981 stones.

N = 38;           // number of stones along base side
SIZE = 500;        // stone edge length in mm (0.5 m)
HALF_BASE = N*SIZE/2; // 9500 mm, to center the pyramid around the tomb center (origin)

budget = 20000;      // total stones available
stonesUsed = N*(N+1)*(2*N+1)/6; // total stones in full 38-layer pyramid
leftover = budget - stonesUsed; // unused stones

volumePerStone = SIZE*SIZE*SIZE;  // 500^3 = 125,000,000 mm^3
totalVolume_mm3 = stonesUsed * volumePerStone;

echo("Pyramid plan: base size ", N, " x ", N, " stones; stone edge 500 mm.");
echo("Stones used (38-layer pyramid): ", stonesUsed);
echo("Budget stones: ", budget);
echo("Leftover stones: ", leftover);
echo("Total stone volume (mm^3): ", totalVolume_mm3);

for (k = [0 : N - 1]) {
  max_i = N - k - 1;
  for (i = [0 : max_i]) {
    for (j = [0 : max_i]) {
      if (k == 0) {
        // Bottom layer: left-lower corner at (i*SIZE - HALF_BASE, j*SIZE - HALF_BASE, 0)
        translate([i*SIZE - HALF_BASE, j*SIZE - HALF_BASE, 0])
          cube([SIZE, SIZE, SIZE], center = false);
      } else {
        // Upper layers: bottom-lower corner offset by  SIZE/2 in x,y, and z = k*SIZE
        translate([i*SIZE + SIZE/2 - HALF_BASE, j*SIZE + SIZE/2 - HALF_BASE, k*SIZE])
          cube([SIZE, SIZE, SIZE], center = false);
      }
    }
  }
}