// OpenSCAD plan: Tallest pyramid with 50 cm cubes given 150,000 stones budget.
// Each cube = 50 cm (500 mm) per side.
// Stacking rule: each upper stone sits on four lower stones with its bottom corners located at the centers of those four stones.
// This yields layers: bottom N x N, then (N-1) x (N-1), ..., up to 1 x 1.
// We determine N such that sum_{i=1..N} i^2 <= budget.
// Stone count budget: 150000 stones.

budget = 150000;      // stones
stone = 500;          // mm (50 cm)
half = stone/2;         // 250 mm

// Compute maximum base dimension N such that 1^2 + 2^2 + ... + N^2 <= budget
N = 0;
S = 0; // sum of squares, total stones used
while (S + (N + 1)*(N + 1) <= budget) {
    N = N + 1;
    S = S + N * N;
}

// Volume calculations (mm^3)
volume_mm3 = S * stone * stone * stone;
volume_m3 = volume_mm3 / 1000000000.0;

// Output debug information
echo("N (base size) = ", N);
echo("Total stones used S = ", S);
echo("Total volume = ", volume_mm3, " mm^3 (", volume_m3, " m^3)");

// Build the pyramid: k = layer index from bottom (0-based) to top (N-1)
// Layer k has (N - k) x (N - k) stones.
// Each layer is offset by half a stone (s/2) in x and y relative to the layer below.
for (k = [0 : N - 1]) {
    M = N - k;
    for (i = [0 : M - 1]) {
        for (j = [0 : M - 1]) {
            x = i * stone + k * half;
            y = j * stone + k * half;
            z = k * stone;
            translate([x, y, z])
                cube([stone, stone, stone], center = false);
        }
    }
}