// OpenSCAD plan: Tallest stable pyramid using budget of 20,000 stones (50 cm side)
// All dimensions in millimeters (mm). Stone = 50 cm = 500 mm.

stone = 500;            // edge length of each stone in mm
budget_stones = 20000;   // total stones available

// Sum of squares: 1^2 + 2^2 + ... + n^2 = n(n+1)(2n+1)/6
function sum_squares(n) = n*(n+1)*(2*n+1)/6;

// Determine maximum number of layers L such that total stones <= budget
n = 1;
while (sum_squares(n) <= budget_stones)
  n = n + 1;
layers = n - 1;

// Compute total stones used and volume
stones_used = sum_squares(layers);
volume_mm3 = stones_used * stone * stone * stone;

echo("Max layers: ", layers,
     ", Stones used: ", stones_used,
     ", Total volume: ", volume_mm3, " mm^3 (", volume_mm3/1e9, " m^3)");

// Build pyramid: base layer has 'layers' x 'layers' stones; each subsequent layer reduces by 1 in both x and y.
// Stacking rule: each upper stone rests on four stones below (centers align at crosspoints).
// Coordinates chosen so that the pyramid is centered and faces north (+y). All dimensions in mm.
module build_pyramid(layers, stone) {
  for (L = [0 : layers - 1]) {
    side = layers - L;            // number of stones along one side in this layer
    z = 250 + L * stone;            // z-centre of this layer (bottom sits on ground)
    for (dx = [0 : side - 1]) {
      for (dy = [0 : side - 1]) {
        x = 250 * (L + 1) + dx * stone;  // x-centre of this stone
        y = 250 * (L + 1) + dy * stone;  // y-centre of this stone
        translate([x, y, z])
          cube([stone, stone, stone], center = true);
      }
    }
  }
}

// Render the pyramid
build_pyramid(layers, stone);