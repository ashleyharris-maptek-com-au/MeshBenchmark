// OpenSCAD plan: Tallest pyramid using 50cm cubes (500mm) with stacking rule:
// Each layer is a square of decreasing size by 1 block per side per level.
// Base has N x N stones; total layers N.
// We maximize height under 600,000 stones budget and 10-men-per-stone constraint.
// With 600,000 stones and this stacking pattern, the largest N is 121 since
// sum_{k=1}^{N} k^2 = N(N+1)(2N+1)/6 <= 600000 -> N=121 (sum = 597861).
// Each layer k (0-based) has side length (N - k) * 50 cm = (N - k) * 500 mm.
// Height per layer = 50 cm = 500 mm.
// All units are millimeters (OpenSCAD default units).
// The plan centers the pyramid on the origin; north (+y) is the positive y-direction.

N = 121;          // number of layers (maximum under stone budget)
STONE = 500;      // cube edge in mm (50 cm)
LAYER_H = 500;    // layer height in mm (50 cm)

module layer(k){
    m = N - k;
    L = m * STONE;                 // side length of the square layer in mm
    // Center the pyramid on origin along x and y
    translate([ -L/2, -L/2, k * LAYER_H ])
        cube([ L, L, LAYER_H ], center=false);
}

// Build the stacked pyramid
for (k = [0 : N - 1]) {
    // Optional color gradient for visualization
    c = [0.2 + (k / N) * 0.6, 0.35, 0.6 - (k / N) * 0.4, 1];
    color(c)
        layer(k);
}

// Summary echoes (mm^3 volumes and counts) for verification in console
// Total stones used: sum_{m=1..N} m^2
sumSquares = 0;
for (i = [1 : N])
    sumSquares = sumSquares + i * i;

// Volume of a single stone (mm^3)
stoneVol = STONE * STONE * STONE;

// Total volume of all stones used in pyramid (mm^3)
totalStoneVolume = sumSquares * stoneVol;

// Optional: display computed metrics in console
echo("Pyramid height (layers): ", N);
echo("Base side length (mm): ", N * STONE);
echo("Sum of squares (stones): ", sumSquares);
echo("Volume of one stone (mm^3): ", stoneVol);
echo("Total stone volume used (mm^3): ", totalStoneVolume);

